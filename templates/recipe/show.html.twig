{% extends 'base.html.twig' %}

{% block body %}

   <main class="container recipe-main">

    {% for message in app.flashes('success') %}
    <div class="flash-notice my-3">
        <div class="alert alert-dismissible">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <p class="mb-0">{{message}}</p>
        </div>
    </div>
    {% endfor %}


      <div class="row justify-content-between text-md-right pt-3 px-3 ml-md-2 mr-md-1 main-title">
        <h2>{{ recipe.name }}</h2>
        <div class="d-none d-md-block">
        Nombre d'avis : {{ recipe.rates|length }}
            {% for i in 1..5 %}
                {% if recipe.averageRate >= i %}
                <i class="fa fa-star" aria-hidden="true"></i>
                {% else %}
                <i class="fa fa-star-o" aria-hidden="true"></i>
                {% endif %}
            {% endfor %} 
        </div>
      </div>
      <div class="row d-block d-md-none pt-2 px-3">
            {% for i in 1..5 %}
                {% if recipe.averageRate >= i %}
                <i class="fa fa-star" aria-hidden="true"></i>
                {% else %}
                <i class="fa fa-star-o" aria-hidden="true"></i>
                {% endif %}
            {% endfor %} 
      </div>
      <div class="row pt-0 pt-md-3 px-3 ml-md-2 mr-md-1 recipe-time-difficulty">
        <p>Temps : environ {{ recipe.duration }} minutes<br>
        {% if recipe.difficulty == 1 %}
          {% set difficulty = 'Débutant' %}
        {% endif %}
        {% if recipe.difficulty == 2 %}
          {% set difficulty = 'Intermédiare' %}
        {% endif %}
        {% if recipe.difficulty == 3 %}
          {% set difficulty = 'Expert' %} 
        {% endif %}
        Difficulté : {{ difficulty }}</p>
      </div>
      <div class="row flex-lg-nowrap pt-md-3 px-3 ml-md-2 mr-md-1">
        <div class="col-12 col-lg-6 order-lg-2 mb-3 mb-lg-0">
        {% if recipe.image is not empty %}
          <img src="{{ asset('assets/images/recipes/' ~ recipe.image) }}" class="img-fluid" alt="">
        {% else %}
          <img src="{{ asset('assets/images/default-recipe.png') }}" class="img-fluid" alt="">
        {% endif %}
        </div>
        <div class="col-12 col-lg-6 p-0">
          <div class="row">
            <div class="col-12 col-md-6">
              <h5>Ingrédients :</h5>
              <ul class="recipe-list">
              {% if recipe.ingredient is not empty %}
              {% for ingredient in recipe.ingredient %}
                <li>{{ ingredient }}</li>
              {% endfor %}
              {% endif %}
              </ul>
            </div>
            <div class="col-12 col-md-6">
              <h5>Matériel :</h5>
              <ul class="recipe-list">
              {% if recipe.equipement is not empty %}
              {% for equipement in recipe.equipement %}
                <li>{{ equipement }}</li>
              {% endfor %}
               {% endif %}
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="row pt-3 px-3 ml-md-2 mr-md-1 recipe-content">
        <h5>Recette :</h5>
      </div>
      <div class="row px-3 ml-md-2 mr-md-1">
        <p class="recipe-user">Proposée par <a href="{{ path('user_read', {'id': recipe.user.id})}}">{{recipe.user.username}}</a></p>
      </div>
      <div class="row px-3 ml-md-2 mr-md-1">
          <p>{{ recipe.content |nl2br }}</p>
      </div>
      <div class="row justify-content-center">
        <div class="col-10 recipe-division"></div>
      </div>
      {% if is_granted('IS_AUTHENTICATED_FULLY') %}
      <div class="row pt-3 px-3 ml-md-2 mr-md-1">
        <div class="col-12 col-md-5 text-center">
          <h5>Noter la recette :</h5>
          <div class="col-12 form-rate">
            <div class="row justify-content-center m-3">
              <form action="" method="post">
                <div class="stars">
                  <input type="radio" name="difficulty" id="difficulty-5" value="5" hidden>
                  <label for="difficulty-5">
                      <i class="fa fa-star"></i>
                      <i class="fa fa-star-o"></i>
                  </label>
                  <input type="radio" name="difficulty" id="difficulty-4" value="4" hidden>
                  <label for="difficulty-4">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star-o"></i>
                  </label>
                  <input type="radio" name="difficulty" id="difficulty-3" value="3" hidden>
                  <label for="difficulty-3">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star-o"></i>
                  </label>
                  <input type="radio" name="difficulty" id="difficulty-2" value="2" hidden>
                  <label for="difficulty-2">
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star-o"></i>
                  </label>
                  <input type="radio" name="difficulty" id="difficulty-1" value="1" hidden>
                  <label for="difficulty-1">
                    <i class="fa fa-star"></i>
                  </label>
                  {% if recipe.user.id == app.user.id %}
                    <p>Vous ne pouvez pas noter votre recette</p>
                  {% elseif recipe.rates %}
                    {% for rate in recipe.rates|filter(rate => rate.user == app.user) %}
                          <p>Vous avez déjà donné une note</p>
                      {% else %}
                          <div class="row justify-content-center m-3">
                            <button class="btn rate-btn">Envoyer la note</button>
                          </div>
                    {% endfor %}
                  {% else %}
                    <div class="row justify-content-center m-3">
                      <button class="btn rate-btn">Envoyer la note</button>
                    </div>
                  {% endif %}
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="col-12 d-md-none">
          <div class="recipe-division"></div>
        </div>
        <div class="col-12 col-md-7 text-center">
          <h5>Ajouter un commentaire :</h5>
          {# <form class="col-12 form-comment" method="post"> #}
          {{ form_start(commentForm) }}
            <div class="row mt-3">
              <label class="col-12">{{form_label (commentForm.title) }} :</label>
              {{form_widget (commentForm.title) }}
            </div>
            <div class="row mt-3">
              <label class="col-12">{{form_label (commentForm.content) }} :</label>
              {{form_widget (commentForm.content) }}
            </div>
            <div class="row justify-content-center m-3">
              <button class="mt-3 btn comment-btn" type="submit">Envoyer le commentaire</button>
            </div>
          {{ form_end(commentForm) }}
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-10 recipe-division"></div>
      </div>
      {% endif %}
      <div class="row pt-3 px-3 ml-md-2 mr-md-1">
        <h5>Commentaires :</h5>
      </div>
      <div class="row justify-content-center mb-5 px-3 ml-md-2 mr-md-1">
        {% if recipe.comments is empty %}
        <p>Cette recette n'a pas encore de commentaire</p>
        {% else %}
        <div class="comments col-12 overflow-auto">
          {% for comment in recipe.comments %}
            <div class="comment">
              <p>{{ comment.title }}</p>
              <p>par {{ comment.user }} le {{ comment.createdAt|date("d/m/Y") }}</p>
              <p>{{ comment.content }}</p><hr>
            </div>
          {% endfor %}
        {% endif %}
        </div>
      </div>
    </main>
{% endblock %}

{% block javascript %}
  <script type="text/javascript">
let rating = document.querySelector('input:checked').value;
$.post("{{ path('recipe_show') }}", {variable : rating},function data(reply){});
</script>
{% endblock %}

